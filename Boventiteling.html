<!DOCTYPE html>
<meta charset="utf-8">
<title>boventitel</title>
<link rel="stylesheet" type="text/css" href="Boventiteling.css">
<body>
	<script src="d3.js"></script>
	<div id="Nederlands" class="upper">
		<h1 id="HeaderNederlands" class="subtitle">
			Nederlands
		</h1>
	</div>
	<hr class="symbol"/>
	<div id="Frans" class="lower">
		<h1 id="HeaderFrans" class="subtitle">
			Fran√ßais
		</h1>
	</div>
	<script>
		var nederlandsTitel = d3.select("#Nederlands").selectAll("h1");
		var fransTitel = d3.select("#Frans").selectAll("h1");

		var jumping = false;
		var resizing = false;
		var numberInput = 0;

		var subtitle = {current: 0, nl: [], fr: [], length: 0, size: 72};

		var pipeParser = d3.dsv("|", "text/plain");
		pipeParser("ondertitels.txt", parseData);

		d3.select("html").on('click', forward);
		d3.select("body").on('keydown', keyListener);

		function blackout(){
			nederlands = nederlandsTitel.data([""]);
			frans = fransTitel.data([""]);

			var black = function (d){
				return "";
			}

			nederlands.text(black);
			frans.text(black);
		}

		function sanatize(subtitle){
			return subtitle.trim().split('//')[0];
		}

		function parseData(data){
			for(var i = 0; i < data.length; i++){
				subtitle.nl.push(sanatize(data[i].nederlands));
				subtitle.fr.push(sanatize(data[i].frans));
			}

			subtitle.length = data.length;

			jumpTo(0);
		};

		function forward(){
			if(subtitle.current < subtitle.length){
				jumpTo(++subtitle.current);
			}
		};

		function backward(){
			if(subtitle.current > 0){
				jumpTo(--subtitle.current);
			}
		};

		function jumpTo(a) {
			nederlands = nederlandsTitel.data([subtitle.nl[a]]);
			frans = fransTitel.data([subtitle.fr[a]]);

			var returnText = function (d){
				return d;
			}

			nederlands.text(returnText);
			frans.text(returnText);

			nederlands.style("font-size", subtitle.size + "px");
			frans.style("font-size", subtitle.size + "px");
		};

		function keyListener(){
			if(d3.event.keyCode == 39){
				zeroState();
				forward();
			} else if(d3.event.keyCode == 32){
				zeroState();
				forward();
			} else if(d3.event.keyCode == 37){
				zeroState();
				backward();
			} else if(d3.event.keyCode == 74){
				jumping = true;
				numberInput = 0;
			} else if(d3.event.keyCode == 83){
				resizing = true;
				numberInput = 0;
			} else if(d3.event.keyCode > 47 && d3.event.keyCode < 58){
				numberInput = 10*numberInput + (d3.event.keyCode - 48);
			} else if(d3.event.keyCode == 13){
				if(jumping){
					if(numberInput < subtitle.length){
						subtitle.current = numberInput;
					}

					zeroState();
					jumpTo(subtitle.current);
				}else if(resizing){
					subtitle.size = numberInput;
					zeroState();
					jumpTo(subtitle.current);
				}
			} else if(d3.event.keyCode == 66){
				blackout();
			}
		};

		function zeroState(){
			jumping = false;
			resizing = false;
			numberInput = 0;
		}
	</script>